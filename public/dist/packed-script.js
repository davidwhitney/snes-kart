!function(t){var s={};function e(i){if(s[i])return s[i].exports;var n=s[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,e),n.l=!0,n.exports}e.m=t,e.c=s,e.d=function(t,s,i){e.o(t,s)||Object.defineProperty(t,s,{enumerable:!0,get:i})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,s){if(1&s&&(t=e(t)),8&s)return t;if(4&s&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(e.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&s&&"string"!=typeof t)for(var n in t)e.d(i,n,function(s){return t[s]}.bind(null,n));return i},e.n=function(t){var s=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(s,"a",s),s},e.o=function(t,s){return Object.prototype.hasOwnProperty.call(t,s)},e.p="",e(e.s=0)}([function(t,s,e){function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var s=16*Math.random()|0;return("x"==t?s:3&s|8).toString(16)}))}function n(t,s){return Math.floor(Math.random()*s)+t}function o(t,s,e){return e=e||0,!(t.x<s.x-e)&&(!(t.x>s.x+e)&&(!(t.y<s.y-e)&&!(t.y>s.y+e)))}function r(t,s,e){const i=(t,s)=>Math.abs(s.x-t.x)+Math.abs(s.y-t.y);if(t.isDisplayed){const o=1*e,r=[{x:t.x-o,y:t.y-o},{x:t.x-o,y:t.y},{x:t.x-o,y:t.y+o},{x:t.x,y:t.y-o},{x:t.x,y:t.y+o},{x:t.x+o,y:t.y-o},{x:t.x+o,y:t.y},{x:t.x+o,y:t.y+o}],h=i({x:t.x,y:t.y},s),c=r.filter(t=>i(t,s)<h);if(c.length>0){const s=c[n(0,c.length)];t.x=s.x,t.y=s.y}}}class h{constructor(){this.ticks=5,this.completed=!1,this.hasTicked=!1}tick(t){this.ticks--,t.hygiene+=2.5,this.removeOneTrash(t),0==this.ticks&&(this.completed=!0),this.hasTicked=!0}removeOneTrash(t){for(let s in t.contents){const e=t.contents[s];if("Trash"===e.constructor.name)return void(t.contents=t.contents.filter(t=>t!==e))}}}class c{constructor(){this.ticks=5,this.completed=!1}tick(t){this.ticks--,t.temperature--,t.hygiene+=.2,0==this.ticks&&(this.completed=!0)}}class a{constructor(){this.ticks=4,this.completed=!1}tick(t){this.ticks--,0==this.ticks&&(this.completed=!0)}onCompletion(t){this.charmMice(t);for(const s of t.contents.filter(t=>"Traveller"==t.constructor.name))s.isPassedOut=!1}charmMice(t){const s=t.contents.filter(t=>"Mouse"===t.constructor.name);for(const e of s)e.leave(t,15)}}class l{constructor(t,s){this.ticks=0,this.status="inactive",this.platforms=[],this.queuedActions=[];for(let t of s)this.platforms.push(new u(t))}start(){this.tickInterval=setInterval(()=>{this.tick()},1e3),this.status="active"}tick(){this.ticks++;const t=this.isGameOver(this);if(t.gameover)this.endGame(t.message);else{for(;this.queuedActions.length>0;){const t=this.queuedActions.shift(),s=t.key.charAt(0).toUpperCase()+t.key.slice(1)+"Buff",e=this.platforms.filter(s=>s.id==t.target)[0],i=this.createBuff(s);e.buffs.push(i)}for(let t of this.platforms)t.tick()}}createBuff(t){try{return"undefined"!=typeof Buffs?new Buffs[t]:Function("return new "+t)()}catch(s){throw"Could not find handler called "+t}}isGameOver(){const t=[{condition:t=>t.platforms.filter(t=>t.temperature>=60).length>0,message:"It's too hot!"},{condition:t=>t.platforms.filter(t=>t.temperature<=-20).length>0,message:"It's too cold!"},{condition:t=>t.platforms.filter(t=>t.hygiene<=0).length>0,message:"It's too disgusting!"},{condition:t=>t.platforms.filter(t=>t.contents.length>=t.capacity).length>0,message:"Your platforms are too full!"}];for(let s of t)if(s.condition(this))return{gameover:!0,message:s.message};return{gameover:!1}}endGame(t){this.status="ended",this.gameovermsg=t,clearInterval(this.tickInterval)}queueAction(t,s){this.queuedActions.length>=3||this.queuedActions.push({key:t,target:s})}registerEvent(t,s){t.platforms.filter(t=>t.id===s.line)[0].unprocessedMessages.push(s)}}class u{constructor(t){this.id=t,this.ticks=0,this.width=500,this.height=200,this.capacity=60,this.temperature=15,this.hygiene=100,this.train=null,this.hasTrain=!1,this.contents=[],this.buffs=[],this.unprocessedMessages=[],this.spawnPoints=[{x:120,y:-25,give:5},{x:350,y:-25,give:5}],this.exits=[{x:0,y:180}]}tick(){for(this.ticks++;this.unprocessedMessages.length>0;){const t=this.unprocessedMessages.shift();t.arrived&&(this.hasTrain=!0,this.train=new m),t.departed&&(this.train.onCompletion(),this.hasTrain=!1,this.train=null)}let t=[this.train,...this.contents,...this.buffs];for(let s of t)s&&(s.tick&&s.tick(this),s.completed&&s.onCompletion&&s.onCompletion(this));this.buffs=this.buffs.filter(t=>!t.completed),this.contents=this.contents.filter(t=>!t.completed),this.capacity=this.capacity<=0?0:this.capacity,this.hygiene=this.hygiene<=0?0:this.hygiene,this.hygiene=this.hygiene>100?100:this.hygiene}}class f{constructor(t,s){this.id=i(),this.ticks=0,this.x=t,this.y=s}}class d extends f{constructor(t,s){super(t,s),this.stepSize=10,this.offscreen={x:600,y:300}}tick(t){this.destination||(this.destination={x:n(0,t.width),y:n(0,t.height)}),(t.hygiene>=80||t.temperature<=0)&&this.leave(t),r(this,this.destination,this.stepSize),o(this,this.offscreen,this.stepSize)?this.completed=!0:o(this,this.destination,this.stepSize)&&(this.destination=null),this.ticks++}leave(t,s){this.stepSize=s||this.stepSize,this.destination=this.offscreen}onCompletion(t){t.hygiene+=5}}class p extends f{constructor(t,s){super(t,s),this.spawnedMouse=!1}tick(t){t.hygiene-=.25;const s=n(0,10);!this.spawnedMouse&&t.hygiene<=80&&s>=9&&(t.contents.push(new d(this.x,this.y)),this.spawnedMouse=!0),this.ticks++}onCompletion(t){}}class m{constructor(){this.id=i(),this.ticks=0,this.hasTicked=!1,this.doorState="closed"}tick(t){t.temperature+=.25,0==this.ticks&&(this.doorState="opening"),this.ticks>10&&(this.doorState="closing"),this.ticks>1&&this.ticks<=10&&t.contents.push(new x),this.ticks++,this.hasTicked=!0}onCompletion(t){}}class x{constructor(){this.id=i(),this.ticks=0,this.ticksFromExit=14,this.completed=!1,this.droppedTrash=!1,this.isPassedOut=!1,this.isDisplayed=!1,this.dancing=!1}tick(t){if(this.ticks++,!this.selectedExit){const s=n(0,t.exits.length);this.selectedExit=t.exits[s]}if(0==this.ticksFromExit)return t.temperature-=1,void(this.completed=!0);if(this.dancing=t.buffs.filter(t=>"MusicBuff"==t.constructor.name).length>0,t.temperature+=.1,this.dancing||this.isPassedOut)return;r(this,this.selectedExit,15),this.ticksFromExit--;const s=this.random();if(!this.droppedTrash&&s>=.95)return t.contents.push(new p(this.x,this.y)),void(this.droppedTrash=!0);!this.isPassedOut&&t.hygiene<=30&&s>=.9&&(this.isPassedOut=!0)}random(){return Math.random()}}new class{constructor(){this.callbacks={}}hasCallbacksFor(t){return-1!=Object.getOwnPropertyNames(this.callbacks).indexOf(t)}onArrivalTo(t,s){this.hasCallbacksFor(t)||(this.callbacks[t]=[]),this.callbacks[t].push(s)}fakeTrainArrival(t){if(this.callbacks[t])for(let s of this.callbacks[t])s({station:t,line:"platformId1",arrived:!0})}fakeTrainDeparture(t){if(this.callbacks[t])for(let s of this.callbacks[t])s({station:t,line:"platformId1",departed:!0})}fakeIncomingData(t){for(let s of this.callbacks[t])s({station:t,line:"platformId1",arrived:!0}),setTimeout(()=>{s({station:t,line:"platformId1",departed:!0}),setTimeout(()=>this.fakeIncomingData(t),12e3)},12e3)}};t.exports={CleanBuff:h,VentBuff:c,MusicBuff:a,Game:l,GameUI:GameUI,Traveller:x,Platform:u,Train:m}}]);